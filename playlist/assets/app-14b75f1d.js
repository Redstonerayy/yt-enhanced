(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(e){if(e.ep)return;e.ep=!0;const t=s(e);fetch(e.href,t)}})();(async()=>{const r=document.querySelector(".video-container"),a=document.querySelector(".export-songs-button"),s=await opendatabase("yt-enhanced",1,upgrade),i=await queryalldata(s,"videos");rendervideos(r,i),chrome.runtime.onMessage.addListener(async(e,t)=>{if(e.target==="playlist"){if(e.type==="videosave"){delete e.type,delete e.tabid,delete e.target;const o=await opendatabase("yt-enhanced",1,upgrade);await addtostore(o,"videos",e);const n=await queryalldata(o,"videos");rendervideos(r,n)}else if(e.type==="checkvid"&&e.tabid){const o=await opendatabase("yt-enhanced",1,upgrade),n=await querybyindex(o,"videos","videoid",e.videoid);chrome.runtime.sendMessage({type:"savedreturn",target:"injected",tabid:e.tabid,issaved:n!==null?n.length:!1})}}}),a.addEventListener("click",async()=>{const e=await opendatabase("yt-enhanced",1,upgrade),o={allvideos:await queryalldata(e,"videos")},c="data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))));let d=new Date,l=String(d.getDate()).padStart(2,"0"),u=String(d.getMonth()+1).padStart(2,"0"),y=d.getFullYear();d=u+"_"+l+"_"+y,chrome.downloads.download({url:c,filename:`yt_enhanced_export_${d}.json`})})})();
